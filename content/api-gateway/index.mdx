---
date: 2020-08-09
title: Learn API Gateway
description:
  An API Gateway is a software engineering pattern that provides clients an
  interface to a complicated backend.
category: 1
keywords:
  - microservices
  - api
  - rest api
  - software engineering
  - microservices pattern
image: index.jpg
---

## Problem

Consider the fictional company **TravelHelper (TH)**. TH helps its users plan
their vacations. TH has been growing over the past few years, and as a result,
so has its application. The TH backend consists of microservices running on AWS
infrastructure.

Just to name a few, TH's backend consists of

- Flights service
- Hotels service
- Restaurants service

These services are developed by individual engineering teams and are deployed
autonomously.

![Individual microservices run autonomously in the cloud.](services.jpg)

TH is trying to figure out how their web and mobile clients will interact with
their backend. After reading
[Make Your Product a Platform](/blog/platform-product), they want to also open
their APIs to 3rd party developers.

## Solution 1

One way they could accomplish the task is by having clients interact with
backend services directly.

![Solution 1: Have the clients talk to services directly.](solution1.jpg)

However, this architecture results in a few problems discussed below.

### Complexity on Clients

Clients have to worry about aggregating data from multiple services in order to
get the data in the format the client application needs. As a result, the client
application gets more complex. What's more, this process distracts from the main
task of building an amazing user experience.

### Network Overhead

<aside>
  <p>
    Apparently, Amazon did a study and found that&nbsp;
    <ExternalLink href="https://www.gigaspaces.com/blog/amazon-found-every-100ms-of-latency-cost-them-1-in-sales">
      every 100ms of latency cost them 1% in sales
    </ExternalLink>.
  </p>
</aside>

The architecture proposed in Solution 1 would require that clients make multiple
round trips over the Internet when communicating with other services. This could
add hundreds of milliseconds to your application load times depending on

- how much data needs to go over the Internet, and
- how far the data needs to go.

### Lack of Flexibility

This architecture exposes the service APIs to the clients directly. This can
make it costly, if not impossible, to upgrade individual service APIs in the
future.

After a discussion with Engineering, TH seeks an alternative solution.

## Solution 2

TH decided they think it would be beneficial to introduce a shim layer between
the clients and the backend microservices. They introduce an **API Gateway**
between the clients and services.

![Solution 2: Clients interact with backend services via an API Gateway.](solution2.jpg)

This API Gateway will

- Provide an interface for clients to interact with backend services
- Aggregate results from multiple backend services before responding to clients
- Handle authentication and authorization

### Client-Server Interface

With an API Gateway, network overhead can reduce as clients only need to make a
single hop over the Internet to reach the API Gateway. The API Gateway service
can then efficiently handle communicating with backend services in a local
network before responding to the client.

### Aggregation

Before the API Gateway returns to the clients, it can efficiently aggregate data
provided by multiple service APIs. This can greatly simplify client
applications. As a result of reducing client code complexity, the performance of
client applications is likely to improve.

### Security

With Solution 1, individual services might have had to figure out a story for
handling authentication and authorization. Authorization and authentication
could be handled at the API Gateway, simplifying individual backend services.

## Implementation

TH liked the API Gateway pattern, so they decided to implement Solution 2. For
implementing an API Gateway, there are 2 popular options:

- REST
- GraphQL

### REST

Defined in
[2000 by Roy Fielding in his doctoral dissertation](https://en.wikipedia.org/wiki/Representational_state_transfer),
REST can be used in the implementation of the API Gateway service. In REST, a
client

- Makes request to a URL such as `https://api.travelhelper.app/itineraties`
- Specifies an HTTP verb such as `GET`, `POST`, `PUT`, or `DELETE`.
- Optionally provides a body: data for the server to process.

Suppose for example, a client wants to fetch a Hero with an id of 1. A client
can perform the following request to the API Gateway.

```
GET https://api.travelhelper.app/hero/1
```

The API Gateway can then coordinate with the other services to get the data it
needs for the request before returning the following response to the client.

```json
{
  "hero": {
    "name": "R2-D2"
  }
}
```

### GraphQL

An alternative approach to implementing the API Gateway is to use GraphQL, which
was developed by Facebook in 2015. A GraphQL request specifies the format of the
data it needs from the server.

From the [documentation](https://graphql.org/learn/queries/), we see our
clients can provide the following schema in its request to the server.

```
{
  hero {
    name
  }
}
```

The API Gateway service can take this schema and communicate with the services
it needs to resolve it before returning the following JSON to the client.

```json
{
  "data": {
    "hero": {
      "name": "R2-D2"
    }
  }
}
```

After much discussion among the engineering teams, TH decided to move forward
implementing GraphQL for the API Gateway service.

## Conclusion

In this article, we learned how TravelHelper implemented an API Gateway to

- Provide an interface between client and server
- Handle data aggregation of individual microservices
- Handle authentication and authorization

### Read more

There is more to API Gateway than what was discussed here, such as the
[Backends for Frontends pattern](https://microservices.io/patterns/apigateway.html).
The book
[Microservices Patterns](https://www.manning.com/books/microservices-patterns)
and the supplementing [website](https://microservices.io/) has more to say on
API Gateway, and on microservices in general.

[Let me know on Twitter](https://ctt.ac/FVr83) what you thought of the article
and I hope you have a good day.
